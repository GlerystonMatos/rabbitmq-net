version: '3.9'
services:
  rabbitmq:
    env_file:
      - ./.env
    image: rabbitmq-net/rabbitmq:latest
    container_name: rabbitmq
    restart: on-failure
    build:
      context: .
      dockerfile: Dockerfile.rabbitmq
    ports:
      - 5672:5672
      - 15672:15672
    volumes:
      - ./rabbitmq/data/:/var/lib/rabbitmq/
      - ./rabbitmq/log/:/var/log/rabbitmq/
    environment:
      - RABBITMQ_DEFAULT_USER=glerystonmatos
      - RABBITMQ_DEFAULT_PASS=123456
    networks:
      - rabbitmq_net

  api:
    image: rabbitmq-net/api:latest
    container_name: api
    restart: on-failure
    build:
      context: .
      dockerfile: Dockerfile.api
    ports:
      - 5002:80
      - 5003:443
    volumes:
      - ./certificate:/app/certificate
      - ./temp-keys:/root/.aspnet/DataProtection-Keys
    environment:
      - TZ=America/Sao_Paulo
      - ASPNETCORE_HTTPS_PORT=443
      - ASPNETCORE_URLS=https://+:443;http://+:80
      - Kestrel__Certificates__Default__Password=1234
      - Kestrel__Certificates__Default__Path=/app/certificate/certificate.pfx
    networks:
      - rabbitmq_net

  console:
    image: rabbitmq-net/console:latest
    container_name: console
    restart: on-failure
    build:
      context: .
      dockerfile: Dockerfile.console
    environment:
      - TZ=America/Sao_Paulo
    networks:
      - rabbitmq_net

networks:
  rabbitmq_net:
    name: rabbitmq_net